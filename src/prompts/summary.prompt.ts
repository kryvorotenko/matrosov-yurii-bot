import { OpenAIHistoryMessage } from '../openai/openai.types';

export const SUMMARY_PROMPT = (
  prevSummary: string | null,
  newMessages: Array<OpenAIHistoryMessage>,
) =>
  `Твоя задача — обновить ДОЛГОЖИВУЩЕЕ краткое содержание диалога (memory).

ВАЖНО:
– Сохраняй только информацию, которая будет полезна в будущих диалогах.
– Игнорируй разовые вопросы, примеры, уточнения и промежуточные рассуждения.
– Отдавай приоритет информации о пользователе.

ПРИОРИТЕТ СОХРАНЕНИЯ (от самого важного):
1. Кто пользователь (имя, роль, профессия, уровень знаний и так далее, всё персональное)
2. Цель пользователя (зачем он пришёл, что хочет сделать и тд)
3. Долгосрочные интересы и темы
4. Принятые решения, выбранные подходы, зафиксированные предпочтения
5. Текущий контекст диалога (если он продолжается)

НЕ СОХРАНЯЙ:
– Повторяющиеся формулировки
– Технические детали одного ответа
– Временные рассуждения
– Вопросы без решений

Текущее краткое содержание:
${prevSummary ?? 'пусто'}

Новые сообщения:
${newMessages.map((msg) => `${msg.role}: ${msg.content}`).join('\n')}

Обнови краткое содержание, сохранив только долгоживущую и значимую информацию.
Формулируй кратко, фактами, без воды.`;
